<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Dashboard - Appointment System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        html, body {
            height: 100%;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
            display: flex;
            flex-direction: column;
        }
        .main-content {
            flex: 1;
        }
        footer {
            flex-shrink: 0;
            margin-top: auto;
        }
        .sidebar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }
        .sidebar-content {
            padding: 20px;
        }
        .sidebar-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 15px;
        }
        .sidebar-menu {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .sidebar-menu li {
            margin-bottom: 10px;
        }
        .sidebar-menu a {
            display: block;
            padding: 12px 15px;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.3s;
            cursor: pointer;
        }
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background: rgba(255, 255, 255, 0.2);
        }
        .main-content {
            margin-left: 250px;
            padding: 20px;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .header-title {
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }
        .header-info {
            text-align: right;
        }
        .header-info p {
            font-size: 14px;
            color: #666;
            margin: 5px 0;
        }
        .logout-btn {
            padding: 8px 16px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .logout-btn:hover {
            background: #c0392b;
        }
        .appointment-card {
            background: white;
            border-left: 5px solid #667eea;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        .appointment-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .appointment-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        .appointment-time {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-pending {
            background: #ffeaa7;
            color: #d63031;
        }
        .status-confirmed {
            background: #81ecec;
            color: #0071bc;
        }
        .status-completed {
            background: #55efc4;
            color: #00b894;
        }
        .status-cancelled {
            background: #fab1a0;
            color: #d63031;
        }
        .appointment-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        .detail-row {
            display: flex;
            flex-direction: column;
        }
        .detail-label {
            font-weight: 600;
            color: #666;
            margin-bottom: 4px;
        }
        .detail-value {
            color: #333;
        }
        .appointment-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn-action {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s;
        }
        .btn-confirm {
            background: #27ae60;
            color: white;
        }
        .btn-confirm:hover {
            background: #229954;
        }
        .btn-complete {
            background: #3498db;
            color: white;
        }
        .btn-complete:hover {
            background: #2980b9;
        }
        .btn-cancel {
            background: #e74c3c;
            color: white;
        }
        .btn-cancel:hover {
            background: #c0392b;
        }
        .filter-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        .filter-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .filter-group label {
            font-weight: 600;
            color: #333;
        }
        .filter-group select, .filter-group input {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }
        .empty-state {
            background: white;
            padding: 40px;
            text-align: center;
            border-radius: 8px;
            color: #666;
        }
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            .main-content {
                margin-left: 200px;
                padding: 10px;
            }
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
            .appointment-details {
                grid-template-columns: 1fr;
            }
            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="sidebar-content">
            <div class="sidebar-title">Staff Portal</div>
            <ul class="sidebar-menu">
                <li><a class="nav-link active" onclick="switchView('appointments')">üìÖ Appointments</a></li>
                <li><a class="nav-link" onclick="switchView('stats')">üìä Statistics</a></li>
                <li><a class="nav-link" onclick="switchView('settings')">‚öôÔ∏è Settings</a></li>
                <li style="margin-top: 30px; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 20px;">
                    <a onclick="handleLogout()">üö™ Logout</a>
                </li>
            </ul>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <div class="header-title" id="page-title">üìÖ Appointments</div>
            <div class="header-info">
                <p id="staff-name">Staff Name</p>
                <p id="staff-role">Role</p>
            </div>
        </div>

        <!-- Appointments View -->
        <div id="appointments-view" class="view-section">
            <!-- Filter Section -->
            <div class="filter-section">
                <div class="filter-group">
                    <label>Filter by Service:</label>
                    <select id="service-filter" onchange="applyFilters()">
                        <option value="">All Services</option>
                        <option value="School/College">School/College</option>
                        <option value="Hospital">Hospital</option>
                        <option value="Company/Factory">Company/Factory</option>
                        <option value="Doctor Clinic">Doctor Clinic</option>
                        <option value="Advocate">Advocate</option>
                        <option value="Teacher">Teacher</option>
                        <option value="Cafe">Cafe</option>
                        <option value="Barber Shop">Barber Shop</option>
                        <option value="Bank">Bank</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Filter by Status:</label>
                    <select id="status-filter" onchange="applyFilters()">
                        <option value="">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="confirmed">Confirmed</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Date:</label>
                    <input type="date" id="date-filter" onchange="applyFilters()">
                </div>
            </div>

            <!-- Appointments List -->
            <div id="appointments-list"></div>
        </div>

        <!-- Statistics View -->
        <div id="stats-view" class="view-section" style="display: none;">
            <div class="empty-state">
                <div class="empty-state-icon">üìä</div>
                <h3 style="font-size: 20px; margin-bottom: 10px; color: #333;">Statistics</h3>
                <p>View detailed statistics about appointments and services (Coming Soon).</p>
            </div>
        </div>

        <!-- Settings View -->
        <div id="settings-view" class="view-section" style="display: none;">
            <div class="empty-state">
                <div class="empty-state-icon">‚öôÔ∏è</div>
                <h3 style="font-size: 20px; margin-bottom: 10px; color: #333;">Settings</h3>
                <p>Manage your profile and preferences (Coming Soon).</p>
            </div>
        </div>
    </div>

    <script>
        // Helper: Show message
        function showMessage(message, type = 'success') {
            const box = document.createElement('div');
            let bgColor = type === 'success' ? 'bg-green-600' : 'bg-red-600';
            box.className = `fixed bottom-4 right-4 max-w-xs ${bgColor} text-white p-4 rounded-xl shadow-2xl z-50 transition-opacity duration-300`;
            box.textContent = message;
            document.body.appendChild(box);
            
            setTimeout(() => {
                box.remove();
            }, 3000);
        }

        // Check staff authentication
        function checkStaffAuth() {
            const staffUser = localStorage.getItem('staffUser');
            if (!staffUser) {
                window.location.href = 'staff-login.html';
                return null;
            }
            return JSON.parse(staffUser);
        }

        // Initialize page
        function initializePage() {
            const staffUser = checkStaffAuth();
            if (!staffUser) return;

            document.getElementById('staff-name').textContent = staffUser.name;
            document.getElementById('staff-role').textContent = `Role: ${staffUser.role}`;
            
            loadAppointments();
        }

        // Load appointments from all localStorage sources
        function loadAppointments() {
            const allAppointments = [];

            // Collect appointments from all service pages
            const services = [
                'school_appointments',
                'hospital_appointments',
                'company_appointments',
                'doctor_appointments',
                'advocate_appointments',
                'teacher_appointments',
                'cafe_appointments',
                'barber_appointments',
                'bank_appointments'
            ];

            services.forEach(service => {
                const appointments = JSON.parse(localStorage.getItem(service) || '[]');
                appointments.forEach(appt => {
                    allAppointments.push({
                        id: appt.appointment_number || (service + '-' + Date.now()),
                        ...appt,
                        status: appt.status || 'pending'
                    });
                });
            });

            // Sort by date
            allAppointments.sort((a, b) => {
                const dateA = new Date(a.appointment_date);
                const dateB = new Date(b.appointment_date);
                return dateB - dateA;
            });

            window.allAppointments = allAppointments;
            applyFilters();
        }

        // Apply filters
        function applyFilters() {
            const serviceFilter = document.getElementById('service-filter').value;
            const statusFilter = document.getElementById('status-filter').value;
            const dateFilter = document.getElementById('date-filter').value;

            let filtered = window.allAppointments || [];

            if (serviceFilter) {
                filtered = filtered.filter(a => a.service === serviceFilter);
            }

            if (statusFilter) {
                filtered = filtered.filter(a => (a.status || 'pending').toLowerCase() === statusFilter.toLowerCase());
            }

            if (dateFilter) {
                filtered = filtered.filter(a => a.appointment_date === dateFilter);
            }

            renderAppointments(filtered);
        }

        // Render appointments
        function renderAppointments(appointments) {
            const container = document.getElementById('appointments-list');

            if (appointments.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <h3 style="font-size: 20px; margin-bottom: 10px; color: #333;">No Appointments</h3>
                        <p>No appointments match your filters.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = appointments.map(appt => {
                const statusClass = {
                    'pending': 'status-pending',
                    'confirmed': 'status-confirmed',
                    'completed': 'status-completed',
                    'cancelled': 'status-cancelled'
                }[(appt.status || 'pending').toLowerCase()] || 'status-pending';

                return `
                    <div class="appointment-card">
                        <div class="appointment-header">
                            <div class="appointment-time">${appt.appointment_time || 'N/A'}</div>
                            <span class="status-badge ${statusClass}">${(appt.status || 'Pending').toUpperCase()}</span>
                        </div>
                        <div class="appointment-details">
                            <div class="detail-row">
                                <span class="detail-label">Client Name</span>
                                <span class="detail-value">${appt.client_name || 'N/A'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Service</span>
                                <span class="detail-value">${appt.service || 'N/A'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Date</span>
                                <span class="detail-value">${appt.appointment_date || 'N/A'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Contact</span>
                                <span class="detail-value">${appt.client_email || appt.client_phone || 'N/A'}</span>
                            </div>
                            <div class="detail-row" style="grid-column: 1/-1;">
                                <span class="detail-label">Appointment Number</span>
                                <span class="detail-value">${appt.appointment_number || appt.id}</span>
                            </div>
                            ${appt.purpose ? `
                                <div class="detail-row" style="grid-column: 1/-1;">
                                    <span class="detail-label">Notes/Purpose</span>
                                    <span class="detail-value">${appt.purpose}</span>
                                </div>
                            ` : ''}
                        </div>
                        <div class="appointment-actions">
                            ${(appt.status || 'pending').toLowerCase() !== 'confirmed' ? `
                                <button class="btn-action btn-confirm" onclick="updateStatus('${appt.id}', 'confirmed')">‚úì Confirm</button>
                            ` : ''}
                            ${(appt.status || 'pending').toLowerCase() !== 'completed' ? `
                                <button class="btn-action btn-complete" onclick="updateStatus('${appt.id}', 'completed')">‚úî Complete</button>
                            ` : ''}
                            ${(appt.status || 'pending').toLowerCase() !== 'cancelled' ? `
                                <button class="btn-action btn-cancel" onclick="updateStatus('${appt.id}', 'cancelled')">‚úï Cancel</button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update appointment status
        function updateStatus(appointmentId, newStatus) {
            if (!confirm(`Mark appointment as ${newStatus}?`)) return;

            // Find and update the appointment in localStorage
            const services = [
                'school_appointments',
                'hospital_appointments',
                'company_appointments',
                'doctor_appointments',
                'advocate_appointments',
                'teacher_appointments',
                'cafe_appointments',
                'barber_appointments',
                'bank_appointments'
            ];

            let updated = false;
            services.forEach(service => {
                const appointments = JSON.parse(localStorage.getItem(service) || '[]');
                const apptIndex = appointments.findIndex(a => 
                    a.appointment_number === appointmentId || (service + '-' + a.submitted_at) === appointmentId
                );
                
                if (apptIndex !== -1) {
                    appointments[apptIndex].status = newStatus;
                    localStorage.setItem(service, JSON.stringify(appointments));
                    updated = true;
                }
            });

            if (updated) {
                showMessage(`Appointment updated to ${newStatus}!`, 'success');
                loadAppointments();
            } else {
                showMessage('Failed to update appointment.', 'error');
            }
        }

        // Switch view
        function switchView(viewName) {
            document.querySelectorAll('.view-section').forEach(v => v.style.display = 'none');
            document.getElementById(viewName + '-view').style.display = 'block';
            
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            event.target.classList.add('active');

            const titles = {
                'appointments': 'üìÖ Appointments',
                'stats': 'üìä Statistics',
                'settings': '‚öôÔ∏è Settings'
            };
            document.getElementById('page-title').textContent = titles[viewName] || 'Dashboard';
        }

        // Handle logout
        function handleLogout() {
            if (!confirm('Are you sure you want to logout?')) return;

            localStorage.removeItem('staffUser');
            localStorage.removeItem('staffRememberMe');
            showMessage('Logged out successfully.', 'success');
            
            setTimeout(() => {
                window.location.href = 'dashboeard.html';
            }, 1500);
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', initializePage);
    </script>

    <!-- FOOTER -->
    <footer id="footer" class="bg-gray-900 text-white w-full">
        <div class="max-w-7xl mx-auto px-4 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-12">
                <div>
                    <h4 class="text-xl font-bold mb-4">AppointmentPro</h4>
                    <p class="text-gray-400 text-sm mb-4">Modern appointment booking system.</p>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-4">Quick Links</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="dashboeard.html" class="text-gray-400 hover:text-white transition">Home</a></li>
                        <li><a href="login.html" class="text-gray-400 hover:text-white transition">Client Login</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-4">Services</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="school.html" class="text-gray-400 hover:text-white transition">School/College</a></li>
                        <li><a href="hospital.html" class="text-gray-400 hover:text-white transition">Hospital</a></li>
                        <li><a href="doctor.html" class="text-gray-400 hover:text-white transition">Doctor</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-4">Follow Us</h4>
                    <div class="flex space-x-4 mb-6">
                        <a href="https://facebook.com" target="_blank" class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center hover:bg-blue-700 transition text-white" title="Facebook">f</a>
                        <a href="https://instagram.com" target="_blank" class="w-10 h-10 bg-pink-600 rounded-full flex items-center justify-center hover:bg-pink-700 transition text-white" title="Instagram">üì∑</a>
                        <a href="https://twitter.com" target="_blank" class="w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center hover:bg-gray-700 transition text-white" title="Twitter">ùïè</a>
                        <a href="https://youtube.com" target="_blank" class="w-10 h-10 bg-red-600 rounded-full flex items-center justify-center hover:bg-red-700 transition text-white" title="YouTube">‚ñ∂Ô∏è</a>
                        <a href="https://linkedin.com" target="_blank" class="w-10 h-10 bg-blue-700 rounded-full flex items-center justify-center hover:bg-blue-800 transition text-white" title="LinkedIn">in</a>
                    </div>
                    <ul class="space-y-1 text-sm text-gray-400">
                        <li>üìß <a href="mailto:info@appointmentpro.com" class="hover:text-white">info@appointmentpro.com</a></li>
                        <li>üìû <a href="tel:+1234567890" class="hover:text-white">+1 (234) 567-890</a></li>
                    </ul>
                </div>
            </div>
            <hr class="border-gray-700 mb-6">
            <div class="flex flex-col md:flex-row justify-between items-center text-sm text-gray-400">
                <p>&copy; 2025 AppointmentPro. All rights reserved.</p>
                <div class="flex space-x-6 mt-4 md:mt-0">
                    <a href="#" class="hover:text-white transition">Privacy Policy</a>
                    <a href="#" class="hover:text-white transition">Terms of Service</a>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>

